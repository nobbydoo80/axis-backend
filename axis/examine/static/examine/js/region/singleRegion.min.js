angular.module("axis.region.singleRegion").controller("SingleRegionController",function(e,n,i,t,o,r,a,s,l,g){function d(e){T.region_template_url=e.region_template_url,a.addRegion(L(e)),S()}function c(e){e&&e.length&&angular.isElement(e)&&(T.heading.destination=e)}function p(e){e&&e.length&&angular.isElement(e)&&(T.heading.element=e)}function u(e){e&&!angular.equals({},e)&&(T.heading.scope=e)}function f(){T.heading.destination&&T.heading.destination.html(t(T.heading.element)(T.heading.scope))}function m(t,o){function a(){try{var e=T.region.object[t];return d&&(d=!!e),e}catch(e){return}}function l(e){var n=r.pathname||location.pathname;let i,t=/(add|enroll)/;i=t.test(n)?n.replace(t,`/${e}/`):`/${T.region.type_name}/${e}/`,s.setUpdatedLink(i),T.region.helpers.page_title&&(document.title=T.region.helpers.page_title)}function g(){o.split(".").reduce(function(e,n,i,t){return i+1==t.length?e[n]=!e[n]:e[n]},e)}T.isPrimaryRegion=!0;var d=!0,c=n.$watch(a,function(e){e&&(d||(l(e),o&&i(function(){g()},0)),c())})}function h(){e.$broadcast(T.event+":success",T.region,T.$element)}function b(n){angular.isObject(n)&&angular.forEach(n,function(e,n){angular.isUndefined(T.regionsErrors[n])&&(T.regionsErrors[n]=[]),angular.isArray(e)?angular.forEach(e,function(e){-1==T.regionsErrors[n].indexOf(e)&&T.regionsErrors[n].push(e)}):-1==T.regionsErrors[n].indexOf(e)&&T.regionsErrors[n].push(e)}),e.$broadcast(T.event+":error",T.region,T.$element)}function R(){T.isDetailTemplateLoaded=!0,i(function(){e.$broadcast(T.event+":detailTemplateLoaded",T.region,T.$element)},0),S()}function v(){T.isFormTemplateLoaded=!0,i(function(){e.$broadcast(T.event+":formTemplateLoaded",T.region,T.$element)},0),S()}function _(){var e=T.region.type_name&&(T.isFormTemplateLoaded||T.isDetailTemplateLoaded);return e&&(T.isDoneLoading=function(){return e}),e}function $(){return 1}function j(){O(),n.options.visible_fields=n.visibleFields||n.options.visible_fields,angular.extend(T,n.options),T.event=T.eventPrefix+T.type_name,E()}function L(e){return e.region_dependencies=n.options.region_dependencies,T.parentRegionObject&&(e.parentRegionObject=T.parentRegionObject),e.region_template_url&&delete e.region_template_url,T.region=n.regionObject=e,T.region}function O(){angular.isDefined(n.visibleFields)&&angular.isDefined(n.options.visible_fields)?o.warn("RegionSet: visible_fields is defined in both the element and options."):angular.isUndefined(n.visibleFields)&&angular.isUndefined(n.options.visible_fields)&&o.warn("RegionSet: visible_fields is not defined on either the element or options.")}function S(){_()&&(T.processing=!1,T.showLoader=!1,i(function(){e.$broadcast("RegionLoaded",T,T.$element),e.$broadcast(T.event,T.region,T.$element)},0))}function y(e){var i=T.region?T.region.region_endpoint_pattern:n.options.region_endpoint_pattern,t=l.utils.formatUrl(i,e.object);return t.indexOf("//")>-1&&(t=l.utils.formatUrl(n.options.endpoints[0],e.object)),t}function E(){var e={region_dependencies:n.options.region_dependencies,object:{},parentRegionSet:{parentRegionObject:T.parentRegionObject}};l.utils.resolveDependencies(e,!1).then(y).then(g.addObjectRequest).then(T.setRegion)}var T=this;T.region=n.regionObject,T.regionsErrors={},T.processing=!1,T.showLoader=!0,T.eventPrefix="SingleRegionLoaded:",T.parentRegionObject=n.$parent.regionObject,T.isFormTemplateLoaded=!1,T.isDetailTemplateLoaded=!1,T.heading={destination:null,element:null,scope:null},T.setRegion=d,T.regionError=b,T.regionSuccess=h,T.isDoneLoading=_,T.compileHeading=f,T.setHeadingScope=u,T.setHeadingElement=p,T.primaryRegionWatcher=m,T.setHeadingDestination=c,T.getRegionCount=$,n.isPrimaryRegion=!1,n.formTemplateLoaded=v,n.detailTemplateLoaded=R,n.flipWatchedAttr=angular.noop,j()}).directive("axisSingleRegion",function(e,n){return{restrict:"E",scope:{options:"=",visibleFields:"=?"},controller:"SingleRegionController",controllerAs:"regionSet",transclude:!0,template:'<loading-spinner ng-if="regionSet.showLoader"></loading-spinner><div ng-transclude/><div ng-include src="regionSet.region_template_url" axis-region region-object="regionObject" ng-if="regionObject"></div>',link:function(e,n,i,t,o){e.regionSet.$element=n,e.regionSet.isPrimaryRegion=!!i.primaryRegion,i.primaryRegion&&e.$root.creating&&e.regionSet.primaryRegionWatcher(i.primaryRegion,i.primaryRegionFlip),i.skipChildRegistration&&(e.skipChildRegistration=e.$eval(i.skipChildRegistration))}}});
