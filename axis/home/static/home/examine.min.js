function updateMultiSelectFieldLabel(e,t,o,n){var r=e.controller.axisFields[t];e.fields[t].value=o,e.fields[t].value_label=n;var i=angular.element(r.find("[multi-select-helper]")[0]).scope();if(void 0!=i){var a=_.indexBy(i.field.widget.choices,"0");for(var s in _.isArray(o)||(o=[o],n=[n]),o)angular.isUndefined(a[o[s]])&&i.field.widget.choices.push([o[s],n[s]]);i.field.widget.choices.push([null,"fake choice"]),setTimeout(function(){i.field.widget.choices.pop(),i.$digest()})}}angular.module("examineApp").controller("HomeFormController",function(e,t,o,n,r){var i={subdivision:"/api/v2/subdivision/[[subdivision]]/",subdivision_relationships:"/api/v2/subdivision/relationships/[[subdivision]]/"},a=["city"],s=["city"],l=e.regionObject.object.address_override;function c(){var t=e.regionObject.object,o=!1;for(var n in a){var r=t[a[n]];o=o||null==r||""===r}return o}function u(e,o){return t.get(e,o).error(function(e,t){console.log(e,t)})}r.addPostMethodToType("save","home",function t(o){l=e.regionObject.object.address_override}),angular.extend(e,{lookupSubdivisionInfo:function(){e.regionObject.object;var t=i.subdivision,r=o(t)(e.regionObject.object);u(r).success(function(t){!function t(o){var n=e.regionObject.object;for(var r in a){var i=a[r];if(!n[i]){if(-1!=s.indexOf(i)){var l=e.region.axisFields[i];angular.element(l.find("[ui-select-helper]")).scope().selectOptions.push({id:o[i],text:o[i+"_name"]})}n[i]=o[i]}}}(t)}),u(r=o(t=i.subdivision_relationships)(e.regionObject.object)).success(function(e){var t=n.getRegionFromTypeName("home_relationships");for(var o in e){var r=void 0!==t.object[o],i=void 0!==t.controller.axisFields[o];if(r&&i){var a=e[o];t.object[o]=a;var s=[];if(_.isArray(a))for(var l in a)s.push(e.names[a[l]]);else s=e.names[a];console.log("Updating relationship field:",o,a,s),updateMultiSelectFieldLabel(t,o,a,s)}else console.log("Skipping field %s (data: %s, field: %s)",o,r,i)}})},makeGeocodeDirty:function(){l&&(e.regionObject.object.address_override=!1,e.regionObject.object.confirmed_address=!1,e.regionObject.object.geocode_response=null)}})}).controller("CityOfHillsboroController",function(e,t,o){var n=this;n.linkThenReload=function(r){n.isProcessing=!0,e.get(r).then(function(){n.isProcessing=!1,o.callMethod("reload",t.regionObject)})}}).controller("HomeStatusFormController",function(e,t,o){var n=["rater_of_record"],r=["rater_of_record"];angular.extend(e,{lookupCompanyUsers:function(){var i;e.regionObject.object,(i=o("/api/v2/company/[[company]]/users/")(e.regionObject.object),t.get(i,void 0).error(function(e,t){console.log(e,t)})).success(function(t){!function t(o){var i=e.regionObject.object;for(var a in n){var s=n[a];if(-1!=r.indexOf(s)){var l=e.region.axisFields[s],c=angular.element(l.find("[multi-select-helper]")).scope();for(var u in c.selectOptions.length=0,e.regionObject.object[s]=null,o){var d=o[u];c.selectOptions.push({id:d[0],text:d[1]})}}i[s]=o[s]}}(t.users)})}})}).controller("ProgramProgressBar",function(e,t){var o=this;function n(){var n;n=e.$watch(function(){return o.progressUrl},function(e,r){e&&(t.get(o.progressUrl,{cache:!1}).success(function(e){o.progress_analysis=e}),n())})}o.region.reloadProgramRequirementsBar=n,n()}).directive("programProgressBar",function(){return{restrict:"E",require:"^axisRegion",scope:{objectId:"=",progressUrl:"=",hasIppPayments:"=",objectState:"=",certificationDate:"=",region:"="},bindToController:!0,controllerAs:"progress",controller:"ProgramProgressBar",templateUrl:"/examine/home/progress_analysis_bar.html"}}).controller("ProgramProgressList",function(e,t,o,n,r,i,a){var s=this;function l(){var t;t=e.$watch(function(){return s.progressUrl},function(e,n){e&&(o.get(s.progressUrl,{cache:!1}).success(function(e){s.progress_analysis=e}),t())})}s.showingCompleted=!1,s.trustAsHtml=t.trustAsHtml,s.region.reloadProgramRequirements=l,s.routeRequirementLink=function e(t){var o=t.split("#instruction-",2);o[0];var a=o[1];if(!a){if(0===t.indexOf("#/")){var l=$('[tab-helper][endpoint="'+t.substr(2).replace("/",".")+'"] a');n(function(){l.click()})}else window.location=t;return}var c=a.split(":",2),u=c[0],d=c[1],p=s.regionObject;if(d){var f=d.split("-",2),h=f[0];f[1],p.type_name!=h&&(p=r.getRegionFromTypeName(h),_.isArray(p)&&(p=p[p.length-1]))}i.callMethod(u,p);var g=$(p.$element).parents(".tab-pane");return _.forEach(g,function(e){var t=(e=$(e)).index(),o=e.parent().closest(".tab-pane,body").find(".nav-tabs").find("li a").eq(t);n(function(){o.click()},0)}),!0},s.toggleCompleted=function e(){s.showingCompleted=!s.showingCompleted},l(),s.scrollTo=function(t){var o=e.$parent.regionObject.id,r=null,i=null,a=null;/annotations/.test(t.url)&&(r=$("#home_status_"+o+"_collapsible"),a=(i=$("#home_status_"+o+"_panel")).find("axis-single-region[options='regionObject.helpers.machinery.annotations']").find("action-strip[data-name='default'] button")),null!==i&&n(function(){r.collapse("show"),null!==a&&a.click();var e=i.parents(".tab-pane");_.forEach(e,function(e){var t=(e=$(e)).index(),o=e.parent().closest(".tab-pane,body").find(".nav-tabs").find("li a").eq(t);n(function(){o.click()},0)}),n(function(){i=$("#"+i.attr("id")),$(window).scrollTop(i.offset().top)},100)},0)}}).directive("programProgressList",function(){return{restrict:"E",require:"^axisRegion",scope:{progressUrl:"=",typeName:"=",regionObject:"=",region:"="},bindToController:!0,controllerAs:"progress",controller:"ProgramProgressList",templateUrl:"/examine/home/progress_analysis.html"}}).directive("genericAnnotationsList",function(){return{restrict:"E",require:"^axisRegion",controller:function(e){e.showingNotes=!0,e.toggleNotes=function(){e.showingNotes=!e.showingNotes}},templateUrl:"/examine/home/annotations_list.html"}}).controller("RemdataOnChangeController",function(e,t,o){var n,r,i={remrate:"/api/v2/floorplan/rem_data_fields/",ekotrope:"/api/v2/floorplan/ekotrope_fields/",houseplans:"/api/v2/ekotrope/houseplan/"},a=["name","number","square_footage"];function s(t){var o=e.regionObject.object;for(var n in a){var r=a[n];o[r]||(o[r]=t[r])}e.loadingInputInfo=!1}function l(e){return t(e).error(function(e,t){console.log(e,t)})}function c(t,o){if(!e.regionObject.object.id&&null!=o&&function t(){var o=e.regionObject.object,n=!1;for(var r in a){var i=o[a[r]];n=n||null==i||""===i}return n}()){var n={id:o,base_name:e.regionObject.object.base_name},r={url:i[t],method:"GET",params:n};e.loadingInputInfo=!0,l(r).success(s)}}function u(t){var o=e.region.axisFields.ekotrope_houseplan;angular.element(o.find("[multi-select-helper]")).scope();var n=e.regionObject.fields.ekotrope_houseplan.widget.choices;for(var r in n.length=0,t.results){var i=[t.results[r].id,t.results[r].name];n.push(i)}}e.$watchGroup(["regionObject.object.remrate_target","regionObject.object.remrate_data_file_raw"],function(t,o){_.every(t)&&(console.log("sending the request"),l({url:"/api/v2/remrate/"+t[0]+"/validate/",method:"POST",data:{file:t[1]}}).success(function(t){console.log("success"),e.validation_data=t,e.data_has_mismatches=0!=Object.keys(e.validation_data).length}))}),n={type:null},void 0!==(r=e.regionObject.fields).remrate_target?n.type="remrate":void 0!==r.ekotrope_houseplan&&(n.type="ekotrope"),e.inputChoice=n,angular.extend(e,{updateEkotropeHousePlanOptions:function t(){var o=e.regionObject.object.ekotrope_project;e.regionObject.object.ekotrope_houseplan=null,l({url:i.houseplans,method:"GET",params:{project:o}}).success(u)},lookupRemrateInfo:function t(){c("remrate",e.regionObject.object.remrate_target)},lookupEkotropeInfo:function t(){c("ekotrope",e.regionObject.object.ekotrope_houseplan)},validationClass:function(e){return e.matches?"text-success":({info:"text-info",warning:"text-warning",error:"text-danger"})[e.level]}})}).controller("NEEABOPController",function(e){var t=e.regionObject.fields["heat-source"],o=e.regionObject.fields["tco-options"],n=Date.parse("06/01/2014"),r=new Date,i=t.widget.choices,a=o.widget.choices,s=angular.copy(i),l=angular.copy(a),c=[t.value,t.value_label||t.value],u=[o.value,o.value_label||o.value],d={"2011 ID/MT BOP 1":["2011 ID/MT BOP 1"],"2011 ID/MT BOP 2":["2011 ID/MT BOP 2"],"2011 WA BOP 1":["2011 WA BOP 1 - Ducts in Conditioned Space","2011 WA BOP 1 - Equipment Upgrade","2011 WA BOP 1 - Envelope Pathway"],"2011 WA BOP 2":["2011 WA BOP 2 - Zonal Electric; Propane and Oil"],"2012 OR BOP 1":["2012 OR BOP 1 - Ducts in Conditioned Space","2012 OR BOP 1 - Equipment Upgrade","2012 OR BOP 1 - Envelope Pathway"],"2012 OR BOP 2":["2012 OR BOP 2 - Zonal Electric; Propane and Oil"],OPPH:["Oregon Premium Performance Home (OPPH)"]};function p(){r<n&&alert("The Northwest ENERGY STAR Homes single-family Builder Option Packages (BOPs) will expire on 6/30/14. All new homes built to single-family BOP guidelines must be permitted and entered into Axis prior to 6/30/14. After this date, the single-family BOPs and TCOs will not be available to associate to new single-family homes in Axis and the Performance Path must be used. The multi-family BOPs are not expiring. Contact your Provider or the Northwest ENERGY STAR Homes program at 800-539-9362 or at info@northwestenergystar.com with any questions.")}angular.extend(e,{updateChoicesFromBOP:function(t){console.log("-- Change BOP --"),i.length=0,a.length=0,i.push.apply(i,s),a.push.apply(a,l);var o=function e(t){var o={one:["Zonal Electric","Propane & Oil"],two:["Heat Pump","Gas with AC","Gas No AC"]},n={one:["2011 ID/MT BOP 1","2011 WA BOP 1","2012 OR BOP 1","NW BOP 1 MF"],two:["2011 ID/MT BOP 2","2011 WA BOP 2","2012 OR BOP 2","NW BOP 2 MF"]},r=!1;for(var a in n)if(-1!=n[a].indexOf(t)){r=!0,console.log("Heat",a,"trim selected",t);var s=o[a];i=i.filter(function(e){return -1==s.indexOf(e[1])||e[0]==c[0]})}return r||console.log("Heat - no trim"),i}(t=function e(t){for(var o in d)if(-1!=d[o].indexOf(t))return p(),console.log("Trim BOP selected",t),o;return console.log("No Trim BOP selected",t),t}(t)),n=function e(t){var o={one:["Mechanically","Sealed","Tankless Water"],two:["Un-vented","Sealed"],three:["Reduced Thermal Bridging","Hybrid","Natural Gas","Un-vented","Mechanically","Sealed","Tankless Water"]},n={one:["2011 ID/MT BOP 1"],two:["2011 WA BOP 1","2012 OR BOP 1"],three:["2011 ID/MT BOP 2","2011 WA BOP 2","2012 OR BOP 2","OPPH","NW BOP 1 MF","NW BOP 2 MF"]},r=!1;for(var i in n)if(-1!=n[i].indexOf(t)){r=!0,console.log("TCO",i,"trim selected",t);var s=o[i];a=a.filter(function(e){return -1==s.indexOf(e[1])||e[0]==u[0]})}return r||console.log("TCO - no trim"),a}(t);e.regionObject.fields["heat-source"].widget.choices=o,e.regionObject.fields["tco-options"].widget.choices=n}})}).controller("NEEABOP2015Controller",function(e){var t=e.regionObject.fields["heat-source"],o=t.widget.choices,n=angular.copy(o),r=[t.value,t.value_label||t.value];angular.extend(e,{updateChoicesFromBOP:function(t){console.log("-- Change BOP --"),o.length=0,o.push.apply(o,n);var i=function e(t){var n={one:["Zonal Electric","Propane & Oil"],two:["Heat Pump","Gas with AC","Gas No AC"]},i={one:["NW BOP 1 MF"],two:["NW BOP 2 MF"]},a=!1;for(var s in i)if(-1!=i[s].indexOf(t)){a=!0,console.log("Heat",s,"trim selected",t);var l=n[s];o=o.filter(function(e){return -1==l.indexOf(e[1])||e[0]==r[0]})}return a||console.log("Heat - no trim"),o}(t);e.regionObject.fields["heat-source"].widget.choices=i}}),e.regionObject.fields.bop.widget.choices=[["NW BOP 1 MF","NW BOP 1 MF"],["NW BOP 2 MF","NW BOP 2 MF"]]}).controller("NWESHDisclaimerController",function(e){var t=JSON.parse(localStorage.getItem("show_nwesh_disclaimer"));e.showDisclaimer=null===t||t,e.toggleDisclaimer=function(t){t.preventDefault(),e.showDisclaimer=!e.showDisclaimer,localStorage.setItem("show_nwesh_disclaimer",e.showDisclaimer)}}).controller("QAStatusController",function(e,t,o){}).controller("QAStatusDetailController",function(e,t,o){e.perLevelWarningChecksMap=[{eep_program_slugs:["ngbs-sf-whole-house-remodel-2020-new","ngbs-mf-whole-house-remodel-2020-new","ngbs-sf-whole-house-remodel-2015-new","ngbs-mf-whole-house-remodel-2015-new","ngbs-sf-whole-house-remodel-2012-new","ngbs-mf-whole-house-remodel-2012-new",],levels:[{level:"bronze",validation:function(t){t>=125&&(e.certificationLevelWarningMessage="Is Bronze correct? Silver level may be available")}},{level:"gold",validation:function(t){t>=181&&(e.certificationLevelWarningMessage="Is Bronze correct? Gold level may be available")}},{level:"emerald",validation:function(t){t>=225&&(e.certificationLevelWarningMessage="Is Bronze correct? Emerald level may be available")}},]},{eep_program_slugs:["ngbs-sf-new-construction-2020-new","ngbs-mf-new-construction-2020-new","ngbs-sf-new-construction-2015-new","ngbs-mf-new-construction-2015-new"],levels:[{level:"bronze",validation:function(t){t>=334&&(e.certificationLevelWarningMessage="Is Bronze correct? Silver level may be available")}},{level:"silver",points_awarded:489,validation:function(t){t>=489&&(e.certificationLevelWarningMessage="Is Silver correct? Gold level may be available")}},{level:"gold",validation:function(t){t>=611&&(e.certificationLevelWarningMessage="Is Gold correct? Emerald level may be available")}},]},{eep_program_slugs:["ngbs-sf-new-construction-2012-new","ngbs-mf-new-construction-2012-new",],levels:[{level:"bronze",validation:function(t){t>=349&&(e.certificationLevelWarningMessage="Is Bronze correct? Silver level may be available")}},{level:"silver",validation:function(t){t>=509&&(e.certificationLevelWarningMessage="Is Silver correct? Gold level may be available")}},{level:"gold",validation:function(t){t>=641&&(e.certificationLevelWarningMessage="Is Gold correct? Emerald level may be available")}}]},{eep_program_slugs:["ngbs-land-development-2020-new",],levels:[{level:"one_star",validation:function(t){t<95&&(e.certificationLevelWarningMessage="Not enough points for any level !")}},{level:"two_stars",validation:function(t){t<122&&(e.certificationLevelWarningMessage="Not enough points for Two Stars !")}},{level:"three_stars",validation:function(t){t<149&&(e.certificationLevelWarningMessage="Not enough points for Three Stars !")}},{level:"four_stars",validation:function(t){t<176&&(e.certificationLevelWarningMessage="Not enough points for Four Stars !")}},]},],e.certificationLevelWarningMessage="",e.greenEnergyBadgesWarningMessage="",e.certificationLevelWarningCheck=function(){let t=parseFloat(e.regionObject.object.hirl_verifier_points_awarded),o=e.regionObject.object.hirl_certification_level_awarded;t&&o&&e.perLevelWarningChecksMap.forEach(function(n){n.eep_program_slugs.indexOf(e.regionObject.object.requirement_eep_program_slug)>-1&&n.levels.forEach(function(e){e.level===o&&e.validation(t)})})},e.warningChecks=function(){e.certificationLevelWarningMessage="",e.greenEnergyBadgesWarningMessage="",e.waterSenseConfirmedsWarningMessage="",e.wriValueAwardedWarningMessage="",e.initialGreenEnrgyBadges=angular.copy(e.regionObject.object.customer_hirl_project_green_energy_badges),e.initialWaterSenseConfirmed=angular.copy(e.regionObject.object.customer_hirl_project_is_require_water_sense_certification),e.initialWRIValueAwarded=angular.copy(e.regionObject.object.customer_hirl_project_is_require_wri_certification),e.certificationLevelWarningCheck(e.regionObject.object.hirl_certification_level_awarded),e.initialGreenEnrgyBadges.length>0&&0===e.regionObject.object.hirl_badges_awarded.length&&(e.greenEnergyBadgesWarningMessage="Badges were indicated at Registration, but nothing was specified in the “NGBS Green+ Badges Awarded” field"),"True"===e.initialWaterSenseConfirmed&&"true"!==e.regionObject.object.hirl_water_sense_confirmed&&(e.waterSenseConfirmedsWarningMessage="WaterSense was indicated at Registration, but nothing was specified in the “WaterSense Confirmed” field"),"True"!==e.initialWRIValueAwarded||e.regionObject.object.hirl_reviewer_wri_value_awarded||(e.wriValueAwardedWarningMessage="Water Performance Path was selected, but nothing was specified in the “Reviewer WRI Value Awarded” field")},e.warningChecks(),o.addPostMethodToType("save",["qa_status",],function(){e.warningChecks()})}).controller("QADocumentCustomerHIRLController",function(e,t,o){e.regionObject.object.is_public=!0}).controller("EtoLegacyCalculationsOutputController",function(e,t){var o=this,n=$(e.regionObject.$element).find(".eto-legacy-calculations-output");function r(){t(function(){var t,r,i,a,s,l,c=e.regionObject,u=c.helpers.eps_url;n.find("form .form-area").empty().append(c.helpers.eps_calculations_form),t=n,r=u,i=t.find(".eto-calculations-legacy-output-data"),a=t.find(".eto-calculations-errors"),s=t.find(".eto-calculations-input"),(l=$.get(r)).success(function(r,a,l){o.loading=!1,o.error=!1,o.success=!0,t.find(".eto-calculations-progress-indicator").remove(),function e(t,o){o.find("[data-name]").each(function(){var e=$(this),o=e.attr("data-name"),n=t[o],r=e.find("td.value"),i=!1;if(e.is("span")&&(r=e),r.attr("data-precision")){var a=parseInt(r.attr("data-precision"));n=-1!=r.text().indexOf("$")?n?"$"+(n=Math.round(n*Math.pow(10,a))/Math.pow(10,a)).toFixed(a):"$0.00":r.is("[data-percentage]")?""+Math.round(100*n*Math.pow(10,a))/Math.pow(10,a)+"%":Math.round(n*Math.pow(10,a))/Math.pow(10,a)}console.log("Reviewing"+o),"rater_incentive"===o&&t.original_rater_incentive&&(n+=" &#8225;",i=!0,$("#eps-manual-override").show()),"builder_incentive"===o&&t.original_builder_incentive&&(n+=" &#8225;",i=!0,$("#eps-manual-override").show()),i?r.html(n):r.text(n);var s=e.attr("data-showview");void 0!==s&&"false"===s&&e.remove()})}(r,t),$(i).slideDown("fast");var c='<div class="btn-group pull-right"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">Full report <span class="caret"></span></button><ul class="dropdown-menu text-left"><li',u=n.attr("data-showview");(void 0===u||"false"===u)&&(c+=' class="hidden ');var d=$(c+='><a class="eto-view-full-report" href="#">View Calculator</a></li><li><a href="'+r.eps_report_url+'">EPS Download</a></li></ul></div>');d.find(".eto-view-full-report").on("click",function(){return s.submit(),!1}),void 0!==r.fasttracksubmission_id&&null!==r.fasttracksubmission_id&&(head_txt='Home as Built &nbsp; <i class="fa fa-lock" data-toggle="tooltip" title="As reported to ETO"></i>',i.find("thead tr th").html(head_txt)),i.find("thead tr th").append(d),e.$apply()}),l.fail(function(t){try{var n=t.responseJSON.errors}catch(r){var n=["Unable to calculate EPS Score! Missing information."]}o.loading=!1,o.error=!0,o.success=!1;var i="<strong>Energy Performance Score cannot yet be calculated.<br />The following ";i+="information items are missing or not valid for the program:</strong><br /><ul>",$.each(n,function(e,t){i+="<li>"+t+"</li>"}),i+="</ul>",a.show().html(i),$(a).slideDown("fast"),e.$apply()})},0)}r(),e.etoInit=r,o.loading=!0,o.error=!1,o.success=!1}).directive("etoLegacyCalculationsOutput",function(){return{restrict:"C",controller:"EtoLegacyCalculationsOutputController",controllerAs:"etoLegacyCalculationsOutputController"}}).directive("rtfCalculationsOutput",function(e){return{restrict:"C",controller:function(t,o,n){var r=this;function i(){r.loading=!0,o.get(t.regionObject.helpers.rtf_url).then(function(e){r.success=!0,r.error=!1,r.errors=!1,r.result=e.data,r.has_reports=null!=e.data.reports&&Object.keys(e.data.reports).length>0,r.loading=!1}).catch(function(e){r.success=!1,r.errors=e.data,r.error=!0,r.result=!1,r.has_reports=!1,r.loading=!1})}r.loading=!0,r.success=!1,r.error=!1,r.show_admin=t.regionObject.helpers.show_admin,r.show_utility_payment=t.regionObject.helpers.show_utility_payment,r.has_bpa_affiliation=t.regionObject.helpers.has_bpa_affiliation,r.program_slug=t.regionObject.helpers.program_slug,i(),t.rtfInit=i,n.$on("navigation:from_checklist",i),e.addPostMethodToType("save",["home","home_status","home_status_annotations","floorplan","home_relationships"],i)},controllerAs:"ctrl"}}).directive("wccCalculationsOutput",function(e){return{restrict:"C",controller:function(t,o,n){var r=this;function i(){r.loading=!0,o.post(t.regionObject.helpers.wcc_url).then(function(e){r.success=!0,r.error=!1,r.errors=!1,r.result=e.data,r.has_reports=null!=e.data.reports&&Object.keys(e.data.reports).length>0,r.loading=!1}).catch(function(e){r.success=!1,r.errors=e.data,r.error=!0,r.result=!1,r.has_reports=!1,r.loading=!1})}r.loading=!0,r.success=!1,r.error=!1,r.show_admin=t.regionObject.helpers.show_admin,r.program_slug=t.regionObject.helpers.program_slug,i(),t.wccInit=i,n.$on("navigation:from_checklist",i),e.addPostMethodToType("save",["home","home_status","home_status_annotations",],i)},controllerAs:"ctrl"}}).directive("etoCalculationsOutput",function(e){return{restrict:"C",controller:function(t,o,n){var r=this;function i(){r.loading=!0,o.post(t.regionObject.helpers.eps_url).then(function(e){r.success=!0,r.error=!1,r.errors=!1,r.result=e.data,r.has_reports=null!=e.data.reports&&Object.keys(e.data.reports).length>0,r.loading=!1}).catch(function(e){r.success=!1,r.errors=e.data,r.error=!0,r.result=!1,r.has_reports=!1,r.loading=!1})}r.loading=!0,r.success=!1,r.error=!1,r.show_admin=t.regionObject.helpers.show_admin,r.show_debug=t.regionObject.helpers.show_debug,i(),t.wccInit=i,n.$on("navigation:from_checklist",i),e.addPostMethodToType("save",["home","home_status","home_status_annotations","floorplan"],i)},controllerAs:"ctrl"}}).controller("FloorplanCopyController",function(e,t,o){var n=this;n.copy=function(n){var r=t.$on("addedRegion:floorplan",function(t,i){r();var a=n.object.floorplan,s=e.regionSet.parentRegionObject;i._autosaving=!0,i.object.existing_floorplan=a,i.fields.existing_floorplan.value=a,o.callMethod("save",s).then(function(){return o.callMethod("save",i).then(function(){return i._autosaving=!1,o.callMethod("exit",s)})})});e.regionSet.fetchNewRegion({form_type:"existing"})}}).controller("BLGUploadController",function(e,t){return{upload:function(){t.callMethod("save",e.regionObject)}}}).controller("TaskTypeModalController",function(e,t,o){var n=this;n.open=function e(){return t({modal:{templateUrl:"/examine/scheduling/manage_task_types.html"}},{controller:{children:[]},helpers:{machinery:{task_types:o.examineApp.pageRegions.task_types}}})}}).controller("InvoiceItemGroupMachineriesController",function(e,t,o,n){t.invoiceItemGroupMachineries=[],t.homeStatusRegion=n.helpers.regionsMap.invoice_home_status,o({method:"GET",url:"/api/v2/homestatus/"+t.homeStatusRegion.object.id+"/invoice_item_groups_machinery/"}).success(function(e,o){t.invoiceItemGroupMachineries=[e,]}),e.$on("invoiceItemGroupMachineries",function(e,o){t.invoiceItemGroupMachineries=[o,]})}).controller("InvoiceHomeStatusController",function(e,t,o,n){var r=this;r.billingStatesMap={new:"New",new_queued:"New - Queued",new_notified:"New - Notified",notice_sent:"Notice Sent",not_pursuing:"Not pursuing",void:"Void",completed:"Completed",complimentary:"Complimentary",test:"Test",4300:"4300"},r.state="",r.newState=angular.copy(r.state),r.changeState=function(t){o({method:"PATCH",url:"/api/v3/hirl_projects/"+t+"/",data:{manual_billing_state:r.newState}}).success(function(t,i){r.state=angular.copy(t.billing_state),$(".modal").modal("hide");o({method:"GET",url:"/api/v2/homestatus/"+n.helpers.regionsMap.invoice_home_status.object.id+"/invoice_item_groups_machinery/"}).success(function(t,o){e.$broadcast("invoiceItemGroupMachineries",t)})})}}).controller("MultipleDocumentController",function(e,t,o){var n=!1;e.region={handleAction:function(e){n=!0;var r=o.getRegionFromTypeName("home_documents"),i=angular.isArray(r)?r[0]:r;return t.callMethod(e,i).finally(function(){n=!1})},isProcessing:function(){return n},regionsEditing:function e(){return _.filter(o.getRegionFromTypeName("home_documents"),function(e){return e.controller.editing()}).length}}}).filter("endsWith",()=>(e,t,o)=>{if(e&&e.length)return e.filter(e=>{var n;return(o?e[o]:e).toString().endsWith(t)})}).filter("startsWith",function(){return function(e,t){for(var o=[],n=0;n<e.length;n++)0===e[n].indexOf(t)&&t.length<e[n].length&&o.push(e[n]);return o}}).run(function(e,t,o,n,r,i,a,s,l,c){var u,d,p,f=_.debounce(r.callMethod,1e3,{leading:!0,trailing:!1}),h=(u=[],d={},p=[],{addLateChecklistHomeId:function(e){var t=e.object.id;a.dispatch(l.setSetting("homeId",t))},reloadHomeStatusProgramProgressDisplay:function(e){var t=null,o=null;"home_status"==e.type_name?t=e.controller:void 0!==e.parentRegionObject?t=e.parentRegionObject.controller:o=_.filter(i.helpers.regions,function(e){return"home_status"==e.type_name&&e.object.id}),o?_.forEach(o,function(e){e.controller.reloadProgramRequirements(),(e.controller.reloadProgramRequirementsBar||angular.noop)()}):t&&t.reloadProgramRequirements&&(t.reloadProgramRequirements(),(t.reloadProgramRequirementsBar||angular.noop)())},reloadQAStatusProgramProgressDisplay:function(e){var t=null,o=null;"qa_status"==e.type_name?t=e.controller:void 0!==e.parentRegionObject?t=e.parentRegionObject.controller:o=_.filter(i.helpers.regions,function(e){return"qa_status"==e.type_name&&e.object.id}),o?_.forEach(o,function(e){e.controller.reloadProgramRequirements&&(e.controller.reloadProgramRequirements(),(e.controller.reloadProgramRequirementsBar||angular.noop)())}):t&&t.reloadProgramRequirements&&(t.reloadProgramRequirements(),(t.reloadProgramRequirementsBar||angular.noop)())},reloadAnalytics:function(){var e=_.filter(i.helpers.regions,function(e){return"analytics"==e.type_name});_.forEach(e,function(e){return r.callMethod("reload",e).then(function(){return e})})},reloadFloatingChecklistStatusArea:function(e){return e},reloadHomeStatus:function(e){var t=e.parentRegionObject,o=[];return void 0!==t?o.push(t):o=_.filter(i.helpers.regions,function(e){return"home_status"==e.type_name}),_.forEach(o,function(e){f("reload",e).then(h.reloadActiveFloorplan)}),e},reloadQAStatus:function(){var e=_.filter(i.helpers.regions,function(e){return"qa_status"==e.type_name&&e.object.id});_.forEach(e,function(e){f("reload",e)})},reloadEtoOutput:function(e){var t=e.parentRegionObject;if(t){var o=$(t.$element).find(".eto-calculations-legacy-output");0!==o.length&&o.scope().etoInit()}},reloadAnnotationsDisplay:function(e){var t=e.controller,o=null;for(var n in t.children)if("home_status_annotations"==t.children[n].type_name){o=t.children[n];break}return o?r.callMethod("reload",o).then(function(){return e}):e},reloadActiveFloorplan:function(e){"floorplan"==e.type_name&&(e=e.parentRegionObject);var t=_.filter(e.controller.children,function(e){return"floorplan"==e.type_name})[0];void 0!==t&&r.callMethod("reload",t)},reloadAllFloorplans:function(){var e=i.getRegionFromTypeName("floorplan")||[];e=_.isArray(e)?e:[e],_.forEach(e,function(e){e.controller.handleAction("reload")})},reloadRelationshipSidebar:function(e){var t=i.getRegionFromTypeName("home"),o=i.getRegionFromTypeName("home_relationships");return o=_.isArray(o)?o:[o],_.forEach(o,function(e){e.controller.handleAction("reload")}),build_relationship_sidebar(null,t),e},reloadHistory:function(e){return $("[id^=history][id$=wrapper].dataTables_wrapper table").each(function(e,t){$(t).dataTable().fnDraw()}),e},clearQAFields:function(e){e.object.new_state=null,"complete"!==e.object.state&&(e.object.result=null),e.object.note=null,e.object.observation_types=[];var t=i.getRegionFromTypeName("qanote_documents");if((t=angular.isArray(t)?t:[t]).length&&t[0]&&t[0].object.id){var o=t[0].parentRegionSet;angular.forEach(o.regions,function(e){i.removeRegion(e)}),o.regions.length=0,o.fetchNewRegion()}return e},populateBLGFields:function(t){var o,n,r=t.blg_data;function a(e,t){_.reject(e.visible_fields,function(t){var o;return o=e.object[t],_.isBoolean(o)||_.isNull(o)||_.isUndefined(o)}).forEach(function(t){_.isArray(e.object[t])?e.object[t].length=0:e.object[t]=null}),e.errors={},console.log("Inserting data into region:",e.type_name,t);var o=!1,n={};for(var r in t)if(!/_name$/.test(r)||isNaN(parseInt(t[r.replace(/_name$/,"")]))){if(_.isArray(t[r])){var i=e.object[r];i.length=0,i.push.apply(i,t[r])}else e.object[r]=t[r];if(void 0!==t[r+"_name"]&&null!==t[r+"_name"]){if(null===t[r]||0===t[r].length)n[r]=["No exact match in Axis found for '"+t[r+"_name"]+"'"],o=!0;else if(/_raw$/.test(r))e.fields[r.replace(/_raw$/,"")].value=t[r+"_name"];else{var a=t[r],l=t[r+"_name"];_.isArray(a)&&(l=[l]),s(e,r,a,l)}}}o&&e.controller.error(n)}function s(e,t,o,n){var r,i,a=e.controller.axisFields[t];e.fields[t].value=o,e.fields[t].value_label=n,i={id:o,text:n},_.isArray(o)&&(i.id=o[0],i.text=n[0]),void 0!==(r=angular.element(a.find("[ui-select-helper]")[0]).scope())&&angular.isUndefined(_.find(r.selectOptions,{id:i.id}))&&r.selectOptions.push(i),updateMultiSelectFieldLabel(e,t,o,n)}function l(t,o,n,r,s){var c=i.getRegionFromTypeName(o);if(s=void 0===s?function(){}:s,void 0===c){var u=angular.element(t.find("axis-region-set[options*="+o+"]")).isolateScope();if(void 0===u.regionSet)return;u.regionSet.endpoints.length=0,u.regionSet.endpoints.push(null),u.regionSet.fetchNewRegion();var d=e.$on("RegionSetLoaded:"+(r||o),function(e,u){c=i.getRegionFromTypeName(o),a(c,n),void 0!==r?l(t,r,{},void 0,s):s(),d()})}else void 0!==c.length&&(c=c[0]),a(c,n),s()}a(i.getRegionFromTypeName("home"),r.home),a(i.getRegionFromTypeName("home_relationships"),r.home_relationships),o=r.home_status,n=function(){var e,o;r.floorplan.remrate_data_file_raw=t.object.blg_file_raw,r.floorplan.remrate_data_file_raw_name=t.object.blg_file_raw_name,e=r.floorplan,o=$("axis-region-set[options*=home_status]"),l(o,"floorplan",e)},l($(document),"home_status",o,"floorplan",n)},updateInternalQANotesList:function(e){if(e.object.id){e.object.qanote_documents=[];var t=i.getRegionFromTypeName("qanote_documents");if(!t)return;t=angular.isArray(t)?t:[t],angular.forEach(t,function(t){t.object.document_raw_name&&e.object.qanote_documents.push(t.object)})}return e},updateNewAndOldProgramIdCache:function(e){if(e.object.id){var t=e.object.id,o=e.object.eep_program;d[t]=o}else u.push(e.object.eep_program)},updateChecklist:function(e){var t=e;"floorplan"==e.type_name&&(t=e.parentRegionObject),t.helpers.collection_request&&a.dispatch(c.discoverCollectors(t.helpers.collection_request))},updateQaRequirementIdCache:function(e){e.object.id||p.push(e.object.requirement)}}),g={blg_creator_fills_out_regions:{handler:h.populateBLGFields,events:["save"],regions:["home_blg"]},satellite_relationships_watch_homestatus:{handler:h.reloadRelationshipSidebar,events:["save","delete"],regions:["home_status"]},satellite_checklist_button_watches_homestatus:{handler:h.reloadFloatingChecklistStatusArea,events:["save"],regions:["home_status","home_status_annotations"]},homestatus_watches_region_updates:{handler:h.reloadHomeStatus,events:["save"],regions:["qa_status","home_status_annotations","floorplan","home_relationships"]},annotations_watches_home_status:{handler:h.reloadAnnotationsDisplay,events:["save"],regions:["home_status"]},program_requirements_watches_region_updates:{handler:h.reloadHomeStatusProgramProgressDisplay,events:["save"],regions:["home_status","home_status_annotations","floorplan","home_relationships","qa_status"]},program_requirements_watches_region_removals:{handler:h.reloadHomeStatusProgramProgressDisplay,events:["delete"],regions:["floorplan"]},stale_active_floorplan_reloads_to_acquire_update:{handler:h.reloadActiveFloorplan,events:["delete"],regions:["floorplan"]},floorplan_refreshes_others_for_potential_loss_of_active_status:{handler:h.reloadAllFloorplans,events:["save"],regions:["floorplan"]},homestatus_exit_refreshes_floorplans_for_new_active_after_possible_upload_event:{handler:h.reloadAllFloorplans,events:["exit"],regions:["home_status"]},eto_watches_floorplan_updates:{handler:h.reloadEtoOutput,events:["save","delete"],regions:["floorplan"]},home_status_hirl_project_updates:{handler:function(o){let n=o.parentRegionObject;var r=i.getRegionFromTypeName("invoice_home_status")||[];r=_.isArray(r)?r:[r],_.forEach(r,function(e){e.controller.handleAction("reload")}),t({method:"GET",url:"/api/v2/homestatus/"+n.object.id+"/invoice_item_groups_machinery/"}).success(function(t,o){e.$broadcast("invoiceItemGroupMachineries",t)})},events:["save"],regions:["home_status_hirl_project"]},hirl_invoice_item_updates:{handler:function(e){let t=e.parentRegionObject;r.callMethod("reload",t);let o=t.parentRegionObject;r.callMethod("reload",o)},events:["save","delete"],regions:["hirl_invoice_item"]},qa_form_clears_after_save:{handler:h.clearQAFields,events:["save"],regions:["qa_status"]},qa_updates_internals_before_save:{type:"pre",handler:h.updateInternalQANotesList,events:["save"],regions:["qa_status"]},analytics_watches_region_updates_watches_region_updates:{handler:h.reloadAnalytics,events:["save","delete"],regions:["home_status","home_status_annotations","floorplan","qa_status","home_relationships"]},push_home_id_to_checklist:{handler:h.addLateChecklistHomeId,events:["save"],regions:["home"]},checklist_watches_homestatus:{handler:h.updateChecklist,events:["save"],regions:["home_status","qa_status"]},checklist_watches_floorplan:{handler:h.updateChecklist,events:["save","delete"],regions:["floorplan"]},homestatus_keeps_cache_of_program_ids:{type:"pre",handler:h.updateNewAndOldProgramIdCache,events:["save"],regions:["home_status"]},qastatus_keeps_cache_of_qa_requirement_ids:{type:"pre",handler:h.updateQaRequirementIdCache,events:["save"],regions:["qa_status"]},history_watches_regions_updates:{handler:h.reloadHistory,events:["save"],regions:["home","home_documents","base_floorplan"]}};function m(e){return e}_.forEach(g,function(e){_.forEach(e.events,function(t){("pre"===e.type?r.addPreMethodToType:r.addPostMethodToType)(t,e.regions,e.handler)})}),_.forEach({decertify:function(e){return t.post(e.helpers.decertify_url).then(function(){return f("reload",e),e})},certify_today:function(e){return t.get(e.helpers.certify_today_url).then(function(){return f("reload",e),e})},ready:function(e){return t.post(e.helpers.state_transition_url,{action:"qa_transition"}).then(function(){return f("reload",e),e})},toggle_abandon:function(e){var o={model_name:"home.eepprogramhomestatus",id:e.object.id,action:e.helpers.next_state};return t.post(e.helpers.state_transition_url,$.param(o),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return f("reload",e),e.controller.success(),e},function(t){e.controller.error(t.data)})},multipleDocumentSave:function(e){var t=i.getRegionFromTypeName(e.type_name);angular.forEach(t,function(e){e.controller.editing()&&e.controller.handleAction("save")})},view_checklist:function(){var e=$('[tab-helper][endpoint="tabs.checklist"] a');o(function(){e.click()})},upload_checklist:m,manage_observations:m,manage_tasks:m,fasttrack:function(e){return t.post(e.helpers.fasttrack_submission_url).then(function(){return f("reload",e),e})},resnet:function(e){return t.get(e.helpers.resnet_submission_url).then(function(){return r.callMethod("reload",e),e.controller.success(),e},function(t){console.log("Error",t),e.controller.error(t.data)})},financial_checklist:function(e){return t.post(e.helpers.standarddisclosuresettings.url,e.object)},clear_financial_checklist:function(e){var t=e.helpers.standarddisclosuresettings.question_data;for(var o in t)for(var n in t[o].items){var r=t[o].items[n].name;e.object[r]=t[o].items[n].null_value}return e},permitandoccupancysettings:function(e){return t.post(e.helpers.permitandoccupancysettings.url,e.object).then(function(){r.callMethod("reload",e)})},clear_permitandoccupancysettings:function(e){var t=e.helpers.permitandoccupancysettings.question_data;for(var o in t)for(var n in t[o].items){var r=t[o].items[n].name;e.object[r]=t[o].items[n].null_value}return e},simulate:function(e){return t.post(e.helpers.simulate_endpoint,{}).then(function(t){return r.callMethod("reload",e),e.controller.success(),e},function(t){e.controller.error(t.data)})},simulateHES:function(e){var o={home_status_id:e.helpers.hes_score_data.home_status_id,rem_simulation_id:e.helpers.hes_score_data.rem_simulation_id,company_id:e.helpers.hes_score_data.company_id,simulation_status_id:e.helpers.hes_score_data.simulation_status_id,hpxml_conversion_id:e.helpers.hes_score_data.hpxml_conversion_id};return t.post(e.helpers.hes_score_data.simulation_endpoint,o).then(function(t){return r.callMethod("reload",e),e.controller.success(),e},function(t){e.controller.error(t.data)})},customer_hirl_qa_sync_batch:function(e){return"complete"!==e.object.state?r.callMethod("save",e).then(function(e){return t.post(e.helpers.customer_hirl_qa_sync_batch_endpoint,{}).then(function(t){return e.controller.success(),e},function(t){e.controller.error(t.data)})}):t.post(e.helpers.customer_hirl_qa_sync_batch_endpoint,{}).then(function(t){return e.controller.success(),e},function(t){e.controller.error(t.data)})},customer_hirl_certify_childrens:function(e){return t.post(e.helpers.customer_hirl_certify_childrens_endpoint,{}).then(function(t){return r.callMethod("reload",e),e.controller.success(),e},function(t){e.controller.error(t.data)})},customer_hirl_sync_documents_across_batch:function(e){return t.post(e.helpers.customer_hirl_sync_documents_across_batch_endpoint,{}).then(function(t){return e.controller.success(),e},function(t){e.controller.error(t.data)})},updateProfile:function(e){return window.open("/profile/"+window.user_id+"/","User Profile")}},function(e,t){r.addMethod(t,e)}),e.$on("addedRegion:home_checklist_button",function(e,t){checklistRegionExists=!0}),angular.isDefined(window.build_relationship_sidebar)&&e.$on("SingleRegionLoaded:home:detailTemplateLoaded",build_relationship_sidebar),e.$on("addedRegion:hirl_invoice_item_group",function(e,t){o(function(){t.controller&&t.controller.handleAction("save")},0)});var v={currentEndpoint:""},b=_.debounce(function(){h.reloadHomeStatusProgramProgressDisplay({}),h.reloadQAStatusProgramProgressDisplay({}),h.reloadAnalytics(),e.$broadcast("navigation:from_checklist")});e.$on("TabService.go",function(e,t){var o=v.currentEndpoint.indexOf("checklist")>-1,n=t.indexOf("checklist")>-1;o&&!n&&b(),v.currentEndpoint=t})}),setInterval(function e(){var t=$('checklist-field input[ng-model="input.answer.data.input"]');if(0!==t.length){var o=angular.element(t).scope().input;void 0!==o.answer&&o.hooks.update()}},1e3);