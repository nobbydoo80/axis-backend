angular.module("examineApp").controller("SubdivisionFormController",function(e,t,n){function i(t){var n=e.regionObject.object;if(!n.city){var i=e.region.axisFields.city,o=angular.element(i.find("[ui-select-helper]")).scope();o.selectOptions.push({id:t.city,text:t.city_name}),n.city=t.city}n.cross_roads||(n.cross_roads=t.cross_roads),n.is_multi_family=t.is_multi_family}function o(t){var n=e.region.axisFields.community,i=angular.element(n.find("[ui-select-helper]")).scope();i.selectOptions.push({id:t.community,text:t.community_name}),e.regionObject.object.community=t.community,e.regionObject.object.community_name=t.community_name}function c(e,i){var o=n.utils.formatUrl(e,i);return t.get(o,{}).error(function(e,t){console.log(e,t)})}var s={subdivision:"/api/v2/subdivision/[[id]]/",community:"/api/v2/community/[[id]]/"},r={lookupCommunityInfo:function(){var t=e.regionObject.object.community,n=s.community,o={id:t};null!=t&&c(n,o).success(i)},validateMultiFamilySetting:function(){},makeGeocodeDirty:function(){e.regionObject.object.address_override=!1,e.regionObject.object.confirmed_address=!1,e.regionObject.object.geocode_response=null},lookupSubdivisionCommunity:function(){var t=e.regionObject.object.name,n=(e.regionObject.object.is_multi_family,s.subdivision),i={id:t};c(n,i).success(o)}};angular.extend(e,r)}).run(function(e,t,n,i){function o(e){return $("[id^=history][id$=wrapper].dataTables_wrapper table").each(function(e,t){$(t).dataTable().fnDraw()}),e}function c(e){return e.object.new_state=null,e.object.result=null,e.object.note=null,e.object.observation_types=[],e}function s(e){return e}n.addPostMethodToType("save",["subdivision","subdivision_documents","base_floorplan"],o),n.addPostMethodToType("save","qa_status",c),n.addMethod("manage_observations",s),n.addMethod("financial_checklist",function(e){return t.post(e.helpers.standarddisclosuresettings.url,e.object)}),n.addMethod("permitandoccupancysettings",function(e){return t.post(e.helpers.permitandoccupancysettings.url,e.object).then(function(){n.callMethod("reload",e)})}),n.addMethod("clear_financial_checklist",function(e){var t=e.helpers.standarddisclosuresettings.question_data;for(var n in t)for(var i in t[n].items){var o=t[n].items[i].name;e.object[o]=t[n].items[i].null_value}return e})});
